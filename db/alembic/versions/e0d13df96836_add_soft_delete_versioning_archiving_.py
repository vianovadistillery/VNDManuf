"""add_soft_delete_versioning_archiving_fields

Revision ID: e0d13df96836
Revises: migrate_to_unified_contacts
Create Date: 2025-11-04 14:28:10.901665

"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision: str = "e0d13df96836"
down_revision: Union[str, None] = "migrate_to_unified_contacts"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table("assemblies", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column(
            "is_active",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=True,
        )
        batch_op.alter_column(
            "yield_factor",
            existing_type=sa.NUMERIC(precision=6, scale=4),
            server_default=None,
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_primary",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column(
            "version", existing_type=sa.INTEGER(), server_default=None, nullable=False
        )
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_assemblies_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_assemblies_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_assemblies_version"), ["version"], unique=False
        )
        batch_op.create_foreign_key(
            batch_op.f("fk_assemblies__parent_product_id__products"),
            "products",
            ["parent_product_id"],
            ["id"],
        )

    with op.batch_alter_table("assembly_cost_dependencies", schema=None) as batch_op:
        batch_op.alter_column(
            "dependency_ts",
            existing_type=sa.DATETIME(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.drop_index(batch_op.f("ix_dep_consumed"))
        batch_op.drop_index(batch_op.f("ix_dep_consumed_txn"))
        batch_op.drop_index(batch_op.f("ix_dep_produced"))
        batch_op.drop_index(batch_op.f("ix_dep_produced_txn"))

    with op.batch_alter_table("assembly_lines", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_assembly_lines_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_assembly_lines_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_assembly_lines_version"), ["version"], unique=False
        )

    with op.batch_alter_table("batch_components", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_batch_components_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_batch_components_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_batch_components_version"), ["version"], unique=False
        )

    with op.batch_alter_table("batch_lines", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_batch_lines_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_batch_lines_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_batch_lines_version"), ["version"], unique=False
        )

    with op.batch_alter_table("batches", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_batches_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_batches_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_batches_version"), ["version"], unique=False
        )

    with op.batch_alter_table("condition_types", schema=None) as batch_op:
        batch_op.drop_constraint(batch_op.f("uq_condition_types__code"), type_="unique")
        batch_op.drop_index(batch_op.f("ix_condition_type_code"))
        batch_op.create_index("ix_condition_type_code", ["code"], unique=False)
        batch_op.create_index(
            batch_op.f("ix_condition_types_code"), ["code"], unique=True
        )

    with op.batch_alter_table("contacts", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column(
            "is_customer",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column(
            "is_supplier",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column(
            "is_other",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column(
            "is_active",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=True,
        )
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.drop_index(batch_op.f("ix_contact_code"))
        batch_op.create_index("ix_contact_code", ["code"], unique=False)
        batch_op.create_index(
            batch_op.f("ix_contacts_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(batch_op.f("ix_contacts_code"), ["code"], unique=True)
        batch_op.create_index(
            batch_op.f("ix_contacts_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_contacts_version"), ["version"], unique=False
        )

    with op.batch_alter_table("customer_prices", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_customer_prices_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_customer_prices_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_customer_prices_version"), ["version"], unique=False
        )
        batch_op.drop_column("contact_id")

    with op.batch_alter_table("customers", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_customers_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_customers_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_customers_version"), ["version"], unique=False
        )

    with op.batch_alter_table("datasets", schema=None) as batch_op:
        batch_op.drop_constraint(batch_op.f("uq_datasets__code"), type_="unique")
        batch_op.drop_index(batch_op.f("ix_dataset_code"))
        batch_op.create_index("ix_dataset_code", ["code"], unique=False)
        batch_op.create_index(batch_op.f("ix_datasets_code"), ["code"], unique=True)

    with op.batch_alter_table("excise_rates", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column(
            "rate_per_l_abv",
            existing_type=sa.NUMERIC(precision=10, scale=4),
            type_=sa.Numeric(precision=10, scale=2),
            existing_nullable=False,
        )
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            "ix_excise_rate_active", ["is_active", "date_active_from"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_excise_rates_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_excise_rates_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_excise_rates_version"), ["version"], unique=False
        )
        batch_op.create_unique_constraint("uq_excise_rate_date", ["date_active_from"])

    with op.batch_alter_table("finished_goods", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_finished_goods_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_finished_goods_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_finished_goods_version"), ["version"], unique=False
        )

    with op.batch_alter_table("formula_lines", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_formula_lines_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_formula_lines_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_formula_lines_version"), ["version"], unique=False
        )
        batch_op.create_foreign_key(
            batch_op.f("fk_formula_lines__product_id__products"),
            "products",
            ["product_id"],
            ["id"],
        )

    with op.batch_alter_table("formulas", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column(
            "is_archived",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column("version", existing_type=sa.INTEGER(), nullable=False)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_formulas_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_formulas_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_formulas_version"), ["version"], unique=False
        )

    with op.batch_alter_table("inventory_lots", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_inventory_lots_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_lots_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_lots_version"), ["version"], unique=False
        )

    with op.batch_alter_table("inventory_movements", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_inventory_movements_archived_at"),
            ["archived_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_movements_deleted_at"),
            ["deleted_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_movements_version"), ["version"], unique=False
        )
        batch_op.create_index("ix_movements_product", ["product_id"], unique=False)
        batch_op.create_foreign_key(
            batch_op.f("fk_inventory_movements__product_id__products"),
            "products",
            ["product_id"],
            ["id"],
        )

    with op.batch_alter_table("inventory_reservations", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column(
            "status",
            existing_type=sa.VARCHAR(length=16),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column(
            "created_at",
            existing_type=sa.DATETIME(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column(
            "updated_at",
            existing_type=sa.DATETIME(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.drop_index(batch_op.f("ix_inventory_reservations_product"))
        batch_op.create_index(
            batch_op.f("ix_inventory_reservations_archived_at"),
            ["archived_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_reservations_deleted_at"),
            ["deleted_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_reservations_version"), ["version"], unique=False
        )
        batch_op.create_foreign_key(
            batch_op.f("fk_inventory_reservations__product_id__products"),
            "products",
            ["product_id"],
            ["id"],
        )

    with op.batch_alter_table("inventory_txns", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column(
            "estimate_flag",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=True,
        )
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_inventory_txns_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_txns_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_inventory_txns_version"), ["version"], unique=False
        )

    with op.batch_alter_table("invoice_lines", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_invoice_lines_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_invoice_lines_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_invoice_lines_version"), ["version"], unique=False
        )

    with op.batch_alter_table("invoices", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_invoices_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_invoices_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_invoices_version"), ["version"], unique=False
        )
        batch_op.drop_column("contact_id")

    with op.batch_alter_table("markups", schema=None) as batch_op:
        batch_op.drop_constraint(batch_op.f("uq_markups__code"), type_="unique")
        batch_op.drop_index(batch_op.f("ix_markup_code"))
        batch_op.create_index("ix_markup_code", ["code"], unique=False)
        batch_op.create_index(batch_op.f("ix_markups_code"), ["code"], unique=True)

    with op.batch_alter_table("pack_conversions", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_pack_conversions_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_pack_conversions_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_pack_conversions_version"), ["version"], unique=False
        )

    with op.batch_alter_table("pack_units", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_pack_units_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_pack_units_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_pack_units_version"), ["version"], unique=False
        )

    with op.batch_alter_table("po_lines", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_po_lines_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_po_lines_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_po_lines_version"), ["version"], unique=False
        )

    with op.batch_alter_table("price_list_items", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_price_list_items_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_price_list_items_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_price_list_items_version"), ["version"], unique=False
        )

    with op.batch_alter_table("price_lists", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_price_lists_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_price_lists_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_price_lists_version"), ["version"], unique=False
        )

    with op.batch_alter_table("product_channel_links", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.alter_column(
            "channel",
            existing_type=sa.VARCHAR(length=32),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.drop_index(batch_op.f("ix_product_channel_links_product"))
        batch_op.create_index(
            batch_op.f("ix_product_channel_links_archived_at"),
            ["archived_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_product_channel_links_deleted_at"),
            ["deleted_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_product_channel_links_version"), ["version"], unique=False
        )
        batch_op.create_foreign_key(
            batch_op.f("fk_product_channel_links__product_id__products"),
            "products",
            ["product_id"],
            ["id"],
        )

    with op.batch_alter_table("product_migration_map", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_migration_map_legacy"))
        batch_op.create_index("ix_migration_map_product", ["product_id"], unique=False)
        batch_op.create_unique_constraint(
            "uq_legacy_mapping", ["legacy_table", "legacy_id"]
        )
        batch_op.create_foreign_key(
            batch_op.f("fk_product_migration_map__product_id__products"),
            "products",
            ["product_id"],
            ["id"],
        )

    with op.batch_alter_table("product_variants", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_product_variants_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_product_variants_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_product_variants_version"), ["version"], unique=False
        )

    with op.batch_alter_table("products", schema=None) as batch_op:
        # Add audit fields only - skip type changes to avoid migration issues
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        # Note: Type changes and other schema modifications skipped for this migration
        # to focus only on adding audit fields. Those can be handled in a separate migration.
        batch_op.create_index(
            batch_op.f("ix_products_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_products_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_products_version"), ["version"], unique=False
        )

    with op.batch_alter_table("purchase_orders", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_purchase_orders_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_purchase_orders_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_purchase_orders_version"), ["version"], unique=False
        )
        batch_op.drop_column("contact_id")

    with op.batch_alter_table("qc_results", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_qc_results_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_qc_results_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_qc_results_version"), ["version"], unique=False
        )
        batch_op.create_foreign_key(
            batch_op.f("fk_qc_results__test_definition_id__quality_test_definitions"),
            "quality_test_definitions",
            ["test_definition_id"],
            ["id"],
        )

    with op.batch_alter_table("quality_test_definitions", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.drop_index(batch_op.f("ix_quality_test_definitions_code"))
        batch_op.create_index("ix_quality_test_code", ["code"], unique=False)
        batch_op.create_index(
            batch_op.f("ix_quality_test_definitions_archived_at"),
            ["archived_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_quality_test_definitions_deleted_at"),
            ["deleted_at"],
            unique=False,
        )
        batch_op.create_index(
            batch_op.f("ix_quality_test_definitions_version"), ["version"], unique=False
        )

    with op.batch_alter_table("raw_material_groups", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("uq_raw_material_groups__code"), type_="unique"
        )
        batch_op.drop_index(batch_op.f("ix_rm_group_code"))
        batch_op.create_index("ix_rm_group_code", ["code"], unique=False)
        batch_op.create_index(
            batch_op.f("ix_raw_material_groups_code"), ["code"], unique=True
        )

    with op.batch_alter_table("raw_material_suppliers", schema=None) as batch_op:
        batch_op.drop_column("contact_id")

    with op.batch_alter_table("revaluations", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.alter_column(
            "revalued_at",
            existing_type=sa.DATETIME(),
            server_default=None,
            existing_nullable=False,
        )
        batch_op.alter_column(
            "propagated_to_assemblies",
            existing_type=sa.BOOLEAN(),
            server_default=None,
            existing_nullable=True,
        )
        batch_op.drop_index(batch_op.f("ix_reval_item_ts"))
        batch_op.drop_index(batch_op.f("ix_reval_lot"))
        batch_op.create_index(
            batch_op.f("ix_revaluations_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_revaluations_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_revaluations_version"), ["version"], unique=False
        )

    with op.batch_alter_table("sales_orders", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_sales_orders_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_sales_orders_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_sales_orders_version"), ["version"], unique=False
        )
        batch_op.drop_column("contact_id")

    with op.batch_alter_table("so_lines", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_so_lines_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_so_lines_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_so_lines_version"), ["version"], unique=False
        )

    with op.batch_alter_table("suppliers", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_suppliers_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_suppliers_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_suppliers_version"), ["version"], unique=False
        )

    with op.batch_alter_table("units", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_units_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_units_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(batch_op.f("ix_units_version"), ["version"], unique=False)

    with op.batch_alter_table("work_order_lines", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("created_at", sa.DateTime(), nullable=True))
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=True))
        batch_op.create_index(
            batch_op.f("ix_work_order_lines_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_work_order_lines_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_work_order_lines_version"), ["version"], unique=False
        )

    with op.batch_alter_table("work_orders", schema=None) as batch_op:
        batch_op.add_column(sa.Column("deleted_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("deleted_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("version", sa.Integer(), nullable=False, server_default="1")
        )
        batch_op.add_column(sa.Column("versioned_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("versioned_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(
            sa.Column("previous_version_id", sa.String(length=36), nullable=True)
        )
        batch_op.add_column(sa.Column("archived_at", sa.DateTime(), nullable=True))
        batch_op.add_column(
            sa.Column("archived_by", sa.String(length=100), nullable=True)
        )
        batch_op.add_column(sa.Column("updated_at", sa.DateTime(), nullable=False))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=False)
        batch_op.create_index(
            batch_op.f("ix_work_orders_archived_at"), ["archived_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_work_orders_deleted_at"), ["deleted_at"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_work_orders_version"), ["version"], unique=False
        )

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table("work_orders", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_work_orders_version"))
        batch_op.drop_index(batch_op.f("ix_work_orders_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_work_orders_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("work_order_lines", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_work_order_lines_version"))
        batch_op.drop_index(batch_op.f("ix_work_order_lines_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_work_order_lines_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("units", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_units_version"))
        batch_op.drop_index(batch_op.f("ix_units_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_units_archived_at"))
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("suppliers", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_suppliers_version"))
        batch_op.drop_index(batch_op.f("ix_suppliers_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_suppliers_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("so_lines", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_so_lines_version"))
        batch_op.drop_index(batch_op.f("ix_so_lines_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_so_lines_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("sales_orders", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column("contact_id", sa.VARCHAR(length=36), nullable=True)
        )
        batch_op.drop_index(batch_op.f("ix_sales_orders_version"))
        batch_op.drop_index(batch_op.f("ix_sales_orders_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_sales_orders_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("revaluations", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_revaluations_version"))
        batch_op.drop_index(batch_op.f("ix_revaluations_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_revaluations_archived_at"))
        batch_op.create_index(batch_op.f("ix_reval_lot"), ["lot_id"], unique=False)
        batch_op.create_index(
            batch_op.f("ix_reval_item_ts"), ["item_id", "revalued_at"], unique=False
        )
        batch_op.alter_column(
            "propagated_to_assemblies",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'0'"),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "revalued_at",
            existing_type=sa.DATETIME(),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            existing_nullable=False,
        )
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("raw_material_suppliers", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column("contact_id", sa.VARCHAR(length=36), nullable=True)
        )

    with op.batch_alter_table("raw_material_groups", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_raw_material_groups_code"))
        batch_op.drop_index("ix_rm_group_code")
        batch_op.create_index(batch_op.f("ix_rm_group_code"), ["code"], unique=1)
        batch_op.create_unique_constraint(
            batch_op.f("uq_raw_material_groups__code"), ["code"]
        )

    with op.batch_alter_table("quality_test_definitions", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_quality_test_definitions_version"))
        batch_op.drop_index(batch_op.f("ix_quality_test_definitions_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_quality_test_definitions_archived_at"))
        batch_op.drop_index("ix_quality_test_code")
        batch_op.create_index(
            batch_op.f("ix_quality_test_definitions_code"), ["code"], unique=1
        )
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("qc_results", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_qc_results__test_definition_id__quality_test_definitions"),
            type_="foreignkey",
        )
        batch_op.drop_index(batch_op.f("ix_qc_results_version"))
        batch_op.drop_index(batch_op.f("ix_qc_results_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_qc_results_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("purchase_orders", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column("contact_id", sa.VARCHAR(length=36), nullable=True)
        )
        batch_op.drop_index(batch_op.f("ix_purchase_orders_version"))
        batch_op.drop_index(batch_op.f("ix_purchase_orders_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_purchase_orders_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("products", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_products__formula_id__formulas"), type_="foreignkey"
        )
        batch_op.drop_constraint(
            batch_op.f("fk_products__purchase_unit_id__units"), type_="foreignkey"
        )
        batch_op.drop_constraint(
            batch_op.f("fk_products__raw_material_group_id__raw_material_groups"),
            type_="foreignkey",
        )
        batch_op.drop_constraint(
            batch_op.f("fk_products__supplier_id__suppliers"), type_="foreignkey"
        )
        batch_op.drop_index(batch_op.f("ix_products_version"))
        batch_op.drop_index(batch_op.f("ix_products_sku"))
        batch_op.drop_index(batch_op.f("ix_products_raw_material_group_id"))
        batch_op.drop_index("ix_products_raw_material_group")
        batch_op.drop_index("ix_products_raw_material_code")
        batch_op.drop_index(batch_op.f("ix_products_product_type"))
        batch_op.drop_index(batch_op.f("ix_products_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_products_archived_at"))
        batch_op.alter_column(
            "updated_at", existing_type=sa.DateTime(), type_=sa.NUMERIC(), nullable=True
        )
        batch_op.alter_column(
            "created_at", existing_type=sa.DateTime(), type_=sa.NUMERIC(), nullable=True
        )
        batch_op.alter_column(
            "archived_at",
            existing_type=sa.DateTime(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_active",
            existing_type=sa.Boolean(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "last_sync",
            existing_type=sa.DateTime(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "xero_item_id",
            existing_type=sa.String(length=100),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "disccdetwo",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "disccdeone",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "salestaxcde",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "taxinc",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "form",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "dgflag",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "distributorcde",
            existing_type=sa.String(length=1),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "industrialcde",
            existing_type=sa.String(length=1),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "contractcde",
            existing_type=sa.String(length=1),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "tradecde",
            existing_type=sa.String(length=1),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "countercde",
            existing_type=sa.String(length=1),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "wholesalecde",
            existing_type=sa.String(length=1),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "retailcde",
            existing_type=sa.String(length=1),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "manufactured_tax_included",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "estimated_at",
            existing_type=sa.DateTime(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "estimated_by",
            existing_type=sa.String(length=100),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "purchase_tax_included",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "purchase_unit_id",
            existing_type=sa.String(length=36),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "supplier_id",
            existing_type=sa.String(length=36),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "base_unit",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "size",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "formula_id",
            existing_type=sa.String(length=36),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "xero_account",
            existing_type=sa.String(length=50),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "last_purchase_date",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "last_movement_date",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "msds_flag",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "condition",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "hazard",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "usage_tax_included",
            existing_type=sa.String(length=1),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "usage_unit",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "raw_material_search_ext",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "raw_material_search_key",
            existing_type=sa.String(length=10),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "raw_material_group_id",
            existing_type=sa.String(length=36),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_archived",
            existing_type=sa.Boolean(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "sellable",
            existing_type=sa.Boolean(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_tracked",
            existing_type=sa.Boolean(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_assemble",
            existing_type=sa.Boolean(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_sell",
            existing_type=sa.Boolean(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_purchase",
            existing_type=sa.Boolean(),
            type_=sa.NUMERIC(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "product_type",
            existing_type=sa.String(length=20),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "ean13",
            existing_type=sa.String(length=20),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "name",
            existing_type=sa.String(length=200),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "sku",
            existing_type=sa.String(length=50),
            type_=sa.TEXT(),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "id", existing_type=sa.String(length=36), type_=sa.TEXT(), nullable=True
        )
        batch_op.drop_column("archived_by")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("product_variants", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_product_variants_version"))
        batch_op.drop_index(batch_op.f("ix_product_variants_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_product_variants_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("product_migration_map", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_product_migration_map__product_id__products"),
            type_="foreignkey",
        )
        batch_op.drop_constraint("uq_legacy_mapping", type_="unique")
        batch_op.drop_index("ix_migration_map_product")
        batch_op.create_index(
            batch_op.f("ix_migration_map_legacy"),
            ["legacy_table", "legacy_id"],
            unique=False,
        )

    with op.batch_alter_table("product_channel_links", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_product_channel_links__product_id__products"),
            type_="foreignkey",
        )
        batch_op.drop_index(batch_op.f("ix_product_channel_links_version"))
        batch_op.drop_index(batch_op.f("ix_product_channel_links_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_product_channel_links_archived_at"))
        batch_op.create_index(
            batch_op.f("ix_product_channel_links_product"), ["product_id"], unique=False
        )
        batch_op.alter_column(
            "channel",
            existing_type=sa.VARCHAR(length=32),
            server_default=sa.text("'shopify'"),
            existing_nullable=False,
        )
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("price_lists", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_price_lists_version"))
        batch_op.drop_index(batch_op.f("ix_price_lists_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_price_lists_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("price_list_items", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_price_list_items_version"))
        batch_op.drop_index(batch_op.f("ix_price_list_items_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_price_list_items_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("po_lines", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_po_lines_version"))
        batch_op.drop_index(batch_op.f("ix_po_lines_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_po_lines_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("pack_units", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_pack_units_version"))
        batch_op.drop_index(batch_op.f("ix_pack_units_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_pack_units_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("pack_conversions", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_pack_conversions_version"))
        batch_op.drop_index(batch_op.f("ix_pack_conversions_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_pack_conversions_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("markups", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_markups_code"))
        batch_op.drop_index("ix_markup_code")
        batch_op.create_index(batch_op.f("ix_markup_code"), ["code"], unique=1)
        batch_op.create_unique_constraint(batch_op.f("uq_markups__code"), ["code"])

    with op.batch_alter_table("invoices", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column("contact_id", sa.VARCHAR(length=36), nullable=True)
        )
        batch_op.drop_index(batch_op.f("ix_invoices_version"))
        batch_op.drop_index(batch_op.f("ix_invoices_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_invoices_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("invoice_lines", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_invoice_lines_version"))
        batch_op.drop_index(batch_op.f("ix_invoice_lines_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_invoice_lines_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("inventory_txns", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_inventory_txns_version"))
        batch_op.drop_index(batch_op.f("ix_inventory_txns_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_inventory_txns_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column(
            "estimate_flag",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'0'"),
            existing_nullable=True,
        )
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("inventory_reservations", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_inventory_reservations__product_id__products"),
            type_="foreignkey",
        )
        batch_op.drop_index(batch_op.f("ix_inventory_reservations_version"))
        batch_op.drop_index(batch_op.f("ix_inventory_reservations_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_inventory_reservations_archived_at"))
        batch_op.create_index(
            batch_op.f("ix_inventory_reservations_product"),
            ["product_id"],
            unique=False,
        )
        batch_op.alter_column(
            "updated_at",
            existing_type=sa.DATETIME(),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            existing_nullable=False,
        )
        batch_op.alter_column(
            "created_at",
            existing_type=sa.DATETIME(),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            existing_nullable=False,
        )
        batch_op.alter_column(
            "status",
            existing_type=sa.VARCHAR(length=16),
            server_default=sa.text("'ACTIVE'"),
            existing_nullable=False,
        )
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("inventory_movements", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_inventory_movements__product_id__products"),
            type_="foreignkey",
        )
        batch_op.drop_index("ix_movements_product")
        batch_op.drop_index(batch_op.f("ix_inventory_movements_version"))
        batch_op.drop_index(batch_op.f("ix_inventory_movements_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_inventory_movements_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("inventory_lots", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_inventory_lots_version"))
        batch_op.drop_index(batch_op.f("ix_inventory_lots_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_inventory_lots_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("formulas", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_formulas_version"))
        batch_op.drop_index(batch_op.f("ix_formulas_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_formulas_archived_at"))
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("version", existing_type=sa.INTEGER(), nullable=True)
        batch_op.alter_column(
            "is_archived",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'0'"),
            existing_nullable=False,
        )
        batch_op.drop_column("archived_by")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("formula_lines", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_formula_lines__product_id__products"), type_="foreignkey"
        )
        batch_op.drop_index(batch_op.f("ix_formula_lines_version"))
        batch_op.drop_index(batch_op.f("ix_formula_lines_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_formula_lines_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("finished_goods", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_finished_goods_version"))
        batch_op.drop_index(batch_op.f("ix_finished_goods_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_finished_goods_archived_at"))
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("excise_rates", schema=None) as batch_op:
        batch_op.drop_constraint("uq_excise_rate_date", type_="unique")
        batch_op.drop_index(batch_op.f("ix_excise_rates_version"))
        batch_op.drop_index(batch_op.f("ix_excise_rates_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_excise_rates_archived_at"))
        batch_op.drop_index("ix_excise_rate_active")
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column(
            "rate_per_l_abv",
            existing_type=sa.Numeric(precision=10, scale=2),
            type_=sa.NUMERIC(precision=10, scale=4),
            existing_nullable=False,
        )
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("datasets", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_datasets_code"))
        batch_op.drop_index("ix_dataset_code")
        batch_op.create_index(batch_op.f("ix_dataset_code"), ["code"], unique=1)
        batch_op.create_unique_constraint(batch_op.f("uq_datasets__code"), ["code"])

    with op.batch_alter_table("customers", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_customers_version"))
        batch_op.drop_index(batch_op.f("ix_customers_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_customers_archived_at"))
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.drop_column("updated_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("customer_prices", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column("contact_id", sa.VARCHAR(length=36), nullable=True)
        )
        batch_op.drop_index(batch_op.f("ix_customer_prices_version"))
        batch_op.drop_index(batch_op.f("ix_customer_prices_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_customer_prices_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("contacts", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_contacts_version"))
        batch_op.drop_index(batch_op.f("ix_contacts_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_contacts_code"))
        batch_op.drop_index(batch_op.f("ix_contacts_archived_at"))
        batch_op.drop_index("ix_contact_code")
        batch_op.create_index(batch_op.f("ix_contact_code"), ["code"], unique=1)
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column(
            "is_active",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'1'"),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_other",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'0'"),
            existing_nullable=False,
        )
        batch_op.alter_column(
            "is_supplier",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'0'"),
            existing_nullable=False,
        )
        batch_op.alter_column(
            "is_customer",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'0'"),
            existing_nullable=False,
        )
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("condition_types", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_condition_types_code"))
        batch_op.drop_index("ix_condition_type_code")
        batch_op.create_index(batch_op.f("ix_condition_type_code"), ["code"], unique=1)
        batch_op.create_unique_constraint(
            batch_op.f("uq_condition_types__code"), ["code"]
        )

    with op.batch_alter_table("batches", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_batches_version"))
        batch_op.drop_index(batch_op.f("ix_batches_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_batches_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("batch_lines", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_batch_lines_version"))
        batch_op.drop_index(batch_op.f("ix_batch_lines_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_batch_lines_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("batch_components", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_batch_components_version"))
        batch_op.drop_index(batch_op.f("ix_batch_components_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_batch_components_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("assembly_lines", schema=None) as batch_op:
        batch_op.drop_index(batch_op.f("ix_assembly_lines_version"))
        batch_op.drop_index(batch_op.f("ix_assembly_lines_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_assembly_lines_archived_at"))
        batch_op.drop_column("updated_at")
        batch_op.drop_column("created_at")
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("version")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    with op.batch_alter_table("assembly_cost_dependencies", schema=None) as batch_op:
        batch_op.create_index(
            batch_op.f("ix_dep_produced_txn"), ["produced_txn_id"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_dep_produced"), ["produced_lot_id"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_dep_consumed_txn"), ["consumed_txn_id"], unique=False
        )
        batch_op.create_index(
            batch_op.f("ix_dep_consumed"), ["consumed_lot_id"], unique=False
        )
        batch_op.alter_column(
            "dependency_ts",
            existing_type=sa.DATETIME(),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            existing_nullable=False,
        )

    with op.batch_alter_table("assemblies", schema=None) as batch_op:
        batch_op.drop_constraint(
            batch_op.f("fk_assemblies__parent_product_id__products"), type_="foreignkey"
        )
        batch_op.drop_index(batch_op.f("ix_assemblies_version"))
        batch_op.drop_index(batch_op.f("ix_assemblies_deleted_at"))
        batch_op.drop_index(batch_op.f("ix_assemblies_archived_at"))
        batch_op.alter_column("updated_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column("created_at", existing_type=sa.DATETIME(), nullable=True)
        batch_op.alter_column(
            "version",
            existing_type=sa.INTEGER(),
            server_default=sa.text("'1'"),
            nullable=True,
        )
        batch_op.alter_column(
            "is_primary",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'0'"),
            existing_nullable=False,
        )
        batch_op.alter_column(
            "yield_factor",
            existing_type=sa.NUMERIC(precision=6, scale=4),
            server_default=sa.text("'1.0'"),
            existing_nullable=True,
        )
        batch_op.alter_column(
            "is_active",
            existing_type=sa.BOOLEAN(),
            server_default=sa.text("'1'"),
            existing_nullable=True,
        )
        batch_op.drop_column("archived_by")
        batch_op.drop_column("archived_at")
        batch_op.drop_column("previous_version_id")
        batch_op.drop_column("versioned_by")
        batch_op.drop_column("versioned_at")
        batch_op.drop_column("deleted_by")
        batch_op.drop_column("deleted_at")

    # ### end Alembic commands ###
